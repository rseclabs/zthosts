# zthosts

A Python CLI tool that generates Linux-compatible hosts file entries from your ZeroTier network members. It queries the ZeroTier Central API, lets you pick a network, and outputs a ready-to-use hosts file mapping each member's ZeroTier IP to its name.

## Prerequisites

- Python 3.8+
- `requests` library (`pip install requests`)
- A ZeroTier Central API token (get one at <https://my.zerotier.com/account>)

## Installation

No install step required. Clone or copy the script and install the one dependency:

```bash
pip install requests
```

## Authentication

Provide your ZeroTier Central API token in one of two ways:

**Option 1 -- CLI argument:**

```bash
python zthosts.py -t YOUR_API_TOKEN
```

**Option 2 -- Environment variable:**

```bash
export ZTNET_API_TOKEN=YOUR_API_TOKEN
python zthosts.py
```

If both are provided, the CLI argument takes priority.

## Usage

```
usage: zthosts.py [-h] [-t TOKEN] [-n NETWORK_ID] [-o OUTPUT] [--stdout-only]
                  [--all-members]
```

### Options

| Flag | Description |
|------|-------------|
| `-h`, `--help` | Show help message and exit |
| `-t`, `--token` | ZeroTier API token (or set `ZTNET_API_TOKEN` env var) |
| `-n`, `--network-id` | ZeroTier network ID -- skip interactive selection |
| `-o`, `--output` | Output file path (default: `./zt-hosts`) |
| `--stdout-only` | Print to stdout only, do not write a file |
| `--all-members` | Include unauthorized members (default: authorized only) |

### Examples

**Interactive mode** -- lists your networks and prompts you to pick one:

```bash
python zthosts.py -t YOUR_TOKEN
```

```
Available ZeroTier Networks:
--------------------------------------------------
  [1] HomeNet (abc1234567890abc) - 5 members
  [2] LabNet (def4567890abcdef) - 12 members

Select a network [1]:
```

**Non-interactive mode** -- specify the network ID directly:

```bash
python zthosts.py -t YOUR_TOKEN -n abc1234567890abc
```

**Write to a custom path:**

```bash
python zthosts.py -t YOUR_TOKEN -n abc1234567890abc -o /tmp/zt-hosts
```

**Print to stdout only (no file written):**

```bash
python zthosts.py -t YOUR_TOKEN -n abc1234567890abc --stdout-only
```

**Append to your system hosts file:**

```bash
python zthosts.py -t YOUR_TOKEN -n abc1234567890abc --stdout-only | sudo tee -a /etc/hosts
```

## Output Format

The generated file follows the standard `/etc/hosts` format with a header comment block:

```
# ZeroTier Hosts - Generated by zthosts
# Network: HomeNet (abc1234567890abc)
# Generated: 2026-02-18 14:30:00 UTC
# Members: 3

10.147.20.1     server-alpha
10.147.20.2     workstation-beta
10.147.20.3     nas-gamma
```

## How It Works

1. Authenticates with the ZeroTier Central API using your token
2. Fetches the list of networks associated with your account
3. Presents an interactive selection prompt (or uses the `--network-id` flag)
4. Retrieves all members of the selected network
5. Filters to authorized members with at least one IP assignment and a name
6. Sanitizes member names for hosts file compatibility (lowercase, hyphens for spaces, alphanumeric only)
7. Writes the output to a file and prints it to stdout

## Name Sanitization

Member names are cleaned up to be valid hostnames:

| Original Name | Sanitized |
|---------------|-----------|
| `Server Alpha` | `server-alpha` |
| `My NAS (backup)` | `my-nas-backup` |
| `  Web--Server  ` | `web-server` |

Members with no name set or no IP assignments are skipped.

## Error Handling

| Scenario | Behavior |
|----------|----------|
| Missing API token | Prints instructions for both auth methods, exits with code 1 |
| API errors (401, 403, 404, 5xx) | Prints status code and reason, exits with code 1 |
| No networks found | Prints informational message, exits with code 1 |
| Network timeout | 10-second timeout on all API requests |
| No qualifying members | Writes a hosts file with the header but no entries |
